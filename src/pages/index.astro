---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import ReviewCard from '../components/ReviewCard.astro';
import { getCollection } from 'astro:content';
import richPagesData from '../data/rich-pages.json';

// Content Collection 리뷰
const reviews = await getCollection('reviews');

// 마크다운 리뷰를 통일된 형식으로 변환
const mdReviews = reviews.map(review => ({
  slug: review.slug,
  title: review.data.title,
  date: review.data.date,
  excerpt: review.data.excerpt,
  lightColor: review.data.lightColor || '#c53030',
  isRichPage: false
}));

// 리치 페이지 목록 (JSON에서)
const richReviews = (richPagesData as any[]).map(page => ({
  slug: page.slug,
  title: page.title,
  date: page.date,
  excerpt: page.excerpt,
  lightColor: '#256FFF',
  isRichPage: true
}));

// 합쳐서 날짜순 정렬
const allReviews = [...mdReviews, ...richReviews].sort((a, b) => {
  return new Date(b.date).getTime() - new Date(a.date).getTime();
});

function formatDateForDisplay(date: string): string {
  if (!date) return '';
  return date.split('T')[0];
}
---

<BaseLayout
  title="테크리뷰Lab"
  description="전자제품, 테크제품 등 관련 상품 및 쇼핑정보를 공유하는 사이트입니다. 최신 IT 제품정보를 꼼꼼하게 제공해드립니다."
>
  <Header />
  <main>
    <h1 class="sr-only">테크리뷰Lab - 전자제품 리뷰 사이트</h1>
    <div class="relative -top-[10px] flex flex-col gap-8">
      {allReviews.length === 0 ? (
        <p>No reviews yet.</p>
      ) : (
        allReviews.map((review) => (
          <ReviewCard
            title={review.title}
            date={review.date}
            displayDate={formatDateForDisplay(review.date)}
            excerpt={review.excerpt}
            slug={review.slug}
            lightColor={review.lightColor}
          />
        ))
      )}
    </div>
  </main>
</BaseLayout>
